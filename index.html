<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gaming Zone Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
    }

    .form-container {
      background: #222;
      padding: 20px;
      border-radius: 12px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 10px #00ffcc88;
    }

    label {
      display: block;
      margin-top: 12px;
      font-weight: bold;
    }

    input, select {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 6px;
      margin-top: 4px;
    }

    button {
      margin-top: 20px;
      padding: 12px 20px;
      border: none;
      background-color: #00ffc3;
      color: #000;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }

    .session-card {
      background: #333;
      margin-top: 20px;
      padding: 15px;
      border-left: 6px solid #00ffc3;
      border-radius: 10px;
      position: relative;
    }

    .timer {
      font-size: 1.2em;
      margin-top: 10px;
    }

    .whatsapp-btn {
      background: #25D366;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      margin-top: 10px;
      display: inline-block;
      text-decoration: none;
    }

    .close-btn {
      position: absolute;
      top: 8px;
      right: 12px;
      background: #444;
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      cursor: pointer;
    }

    .child-warning {
      color: #ff4d4d;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>Gaming Zone Session Tracker</h2>
    <form id="sessionForm">
      <label for="name">Player Name</label>
      <input type="text" id="name" required />

      <label for="mobile">Mobile Number</label>
      <input type="tel" id="mobile" required />

      <label for="address">Address</label>
      <input type="text" id="address" required />

      <label for="system">System Number</label>
      <select id="system" required>
        <option value="">Select System</option>
        <option value="PC1">PC1</option>
        <option value="PC2">PC2</option>
        <option value="PC3">PC3</option>
        <option value="PC4">PC4</option>
        <option value="PC5">PC5</option>
        <option value="PC6">PC6</option>
        <option value="PS4-1">PS4-1</option>
        <option value="PS4-2">PS4-2</option>
      </select>

      <label for="duration">Session Duration (minutes)</label>
      <select id="duration" required>
        <option value="">Select Duration</option>
        <option value="30">30 mins</option>
        <option value="60">1 hour</option>
        <option value="90">1.5 hours</option>
        <option value="120">2 hours</option>
      </select>

      <label>
        <input type="checkbox" id="isChild" />
        Player is below 12 years
      </label>

      <button type="submit">Start Session</button>
    </form>
  </div>

  <div id="sessionsContainer"></div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("sessionForm");
      const sessionsContainer = document.getElementById("sessionsContainer");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("name").value.trim();
        const mobile = document.getElementById("mobile").value.trim();
        const address = document.getElementById("address").value.trim();
        const system = document.getElementById("system").value;
        const duration = parseInt(document.getElementById("duration").value);
        const isChild = document.getElementById("isChild").checked;

        if (!name || !mobile || !address || !system || !duration) {
          alert("Please fill in all required fields.");
          return;
        }

        const endTime = Date.now() + duration * 60000;

        const sessionCard = document.createElement("div");
        sessionCard.className = "session-card";

        const closeBtn = document.createElement("button");
        closeBtn.textContent = "√ó";
        closeBtn.className = "close-btn";
        closeBtn.onclick = () => sessionCard.remove();
        sessionCard.appendChild(closeBtn);

        sessionCard.innerHTML += `
          <strong>${name}</strong> (${system})<br/>
          üìû ${mobile}<br/>
          üè† ${address}<br/>
          ‚è≥ <span class="timer"></span><br/>
          üí∞ ‚Çπ${system.startsWith("PS4") ? 150 : 100}
          ${isChild ? '<div class="child-warning">Under 12 - Parental approval required!</div>' : ''}
        `;

        const timerSpan = sessionCard.querySelector(".timer");
        const updateTimer = () => {
          const now = Date.now();
          const remaining = Math.max(0, endTime - now);
          const minutes = Math.floor(remaining / 60000);
          const seconds = Math.floor((remaining % 60000) / 1000);
          timerSpan.textContent = `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;

          if (remaining <= 0) {
            clearInterval(interval);
            timerSpan.textContent = "Session Over";

            if (isChild) {
              const alertMsg = `‚ö†Ô∏è ${name}'s (${system}) session has ended.\nParental pickup needed.`;
              const whatsappUrl = `https://wa.me/91${mobile}?text=${encodeURIComponent(alertMsg)}`;
              const waBtn = document.createElement("a");
              waBtn.href = whatsappUrl;
              waBtn.className = "whatsapp-btn";
              waBtn.target = "_blank";
              waBtn.textContent = "Alert Parent on WhatsApp";
              sessionCard.appendChild(waBtn);
            }
          } else if (remaining <= duration * 6000) {
            timerSpan.style.color = "#ffcc00";
          }
        };

        updateTimer();
        const interval = setInterval(updateTimer, 1000);
        sessionsContainer.appendChild(sessionCard);

        try {
          const response = await fetch("/api/save-session", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              name,
              mobile,
              address,
              systemNumber: system,
              duration,
              isChild,
              startTime: new Date().toISOString(),
            }),
          });

          const result = await response.json();
          if (response.ok) {
            console.log("Session saved:", result);
          } else {
            console.error("Failed to save:", result.message);
          }
        } catch (err) {
          console.error("Error sending data:", err);
        }

        form.reset();
      });
    });
  </script>
</body>
</html>
